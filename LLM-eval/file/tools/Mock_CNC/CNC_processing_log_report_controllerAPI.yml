openapi: 3.0.3
info:
  title: CNC加工日志与报表控制器API
  description: CNC加工日志记录和生产报表相关接口
  version: 1.0.0
  contact:
    name: CNC加工日志与报表API
servers:
  - url: http://192.168.2.201:8083
    description: 开发环境服务器
tags:
  - name: 加工日志
    description: 加工日志记录相关操作
  - name: 生产报表
    description: 生产报表生成相关操作
paths:
  /cnc/process/logs:
    post:
      tags:
        - 加工日志
      summary: 上传加工日志
      description: 上传加工过程日志记录
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                machineId:
                  type: string
                  description: 设备ID
                  example: "MACHINE-001"
                operator:
                  type: string
                  description: 操作员
                  example: "张工"
                workpieceId:
                  type: string
                  description: 工件ID
                  example: "WORKPIECE-001"
                processType:
                  type: string
                  description: 加工类型
                  example: "铣削"
                startTime:
                  type: string
                  description: 开始时间
                  example: "2025-09-23T08:00:00Z"
                endTime:
                  type: string
                  description: 结束时间
                  example: "2025-09-23T10:30:00Z"
                parameters:
                  type: object
                  description: 加工参数
                  example:
                    spindleSpeed: 12000
                    feedRate: 500
                    cuttingDepth: 2.5
                status:
                  type: string
                  description: 加工状态
                  example: "完成"
                notes:
                  type: string
                  description: 备注信息
                  example: "加工过程正常"
              required:
                - machineId
                - operator
                - workpieceId
                - processType
                - startTime
                - endTime
                - parameters
                - status
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  logId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  operator:
                    type: string
                    example: "张工"
                  workpieceId:
                    type: string
                    example: "WORKPIECE-001"
                  processType:
                    type: string
                    example: "铣削"
                  startTime:
                    type: string
                    example: "2025-09-23T08:00:00Z"
                  endTime:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  parameters:
                    type: object
                    properties:
                      spindleSpeed:
                        type: integer
                        example: 12000
                      feedRate:
                        type: integer
                        example: 500
                      cuttingDepth:
                        type: number
                        example: 2.5
                  status:
                    type: string
                    example: "完成"
                  notes:
                    type: string
                    example: "加工过程正常"
                  createdAt:
                    type: string
                    format: date-time
  /cnc/process/logs/{logId}:
    get:
      tags:
        - 加工日志
      summary: 查询加工日志
      description: 根据日志ID查询加工日志详情
      parameters:
        - name: logId
          in: path
          required: true
          schema:
            type: integer
          description: 日志ID
          example: 1695476400000
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  logId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  operator:
                    type: string
                    example: "张工"
                  workpieceId:
                    type: string
                    example: "WORKPIECE-001"
                  processType:
                    type: string
                    example: "铣削"
                  startTime:
                    type: string
                    example: "2025-09-23T08:00:00Z"
                  endTime:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  parameters:
                    type: object
                    properties:
                      spindleSpeed:
                        type: integer
                        example: 12000
                      feedRate:
                        type: integer
                        example: 500
                      cuttingDepth:
                        type: number
                        example: 2.5
                  status:
                    type: string
                    example: "完成"
                  notes:
                    type: string
                    example: "加工过程正常"
        '400':
          description: 无效的日志ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的日志ID"
  /cnc/process/reports:
    post:
      tags:
        - 生产报表
      summary: 上传生产报表
      description: 上传生产报表数据
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reportType:
                  type: string
                  description: 报表类型
                  example: "日报"
                dateRange:
                  type: object
                  description: 日期范围
                  properties:
                    start:
                      type: string
                      example: "2025-09-23T00:00:00Z"
                    end:
                      type: string
                      example: "2025-09-23T23:59:59Z"
                machines:
                  type: array
                  items:
                    type: string
                  description: 涉及设备列表
                  example: ["MACHINE-001", "MACHINE-002"]
                summary:
                  type: object
                  description: 汇总信息
                  properties:
                    totalWorkpieces:
                      type: integer
                      example: 120
                    completedWorkpieces:
                      type: integer
                      example: 115
                    defectRate:
                      type: number
                      example: 0.042
                    totalOperatingTime:
                      type: number
                      example: 18.5
                details:
                  type: array
                  description: 详细数据
                  items:
                    type: object
                    properties:
                      machineId:
                        type: string
                        example: "MACHINE-001"
                      totalWorkpieces:
                        type: integer
                        example: 60
                      completedWorkpieces:
                        type: integer
                        example: 58
                      defectRate:
                        type: number
                        example: 0.033
                      totalOperatingTime:
                        type: number
                        example: 9.2
                generatedBy:
                  type: string
                  description: 生成人
                  example: "系统管理员"
              required:
                - reportType
                - dateRange
                - machines
                - summary
                - details
                - generatedBy
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  reportId:
                    type: integer
                    example: 1695476400000
                  reportType:
                    type: string
                    example: "日报"
                  dateRange:
                    type: object
                    properties:
                      start:
                        type: string
                        example: "2025-09-23T00:00:00Z"
                      end:
                        type: string
                        example: "2025-09-23T23:59:59Z"
                  machines:
                    type: array
                    items:
                      type: string
                    example: ["MACHINE-001", "MACHINE-002"]
                  summary:
                    type: object
                    properties:
                      totalWorkpieces:
                        type: integer
                        example: 120
                      completedWorkpieces:
                        type: integer
                        example: 115
                      defectRate:
                        type: number
                        example: 0.042
                      totalOperatingTime:
                        type: number
                        example: 18.5
                  details:
                    type: array
                    items:
                      type: object
                      properties:
                        machineId:
                          type: string
                          example: "MACHINE-001"
                        totalWorkpieces:
                          type: integer
                          example: 60
                        completedWorkpieces:
                          type: integer
                          example: 58
                        defectRate:
                          type: number
                          example: 0.033
                        totalOperatingTime:
                          type: number
                          example: 9.2
                  generatedBy:
                    type: string
                    example: "系统管理员"
                  generatedAt:
                    type: string
                    format: date-time
    get:
      tags:
        - 生产报表
      summary: 查询生产报表
      description: 根据报表ID查询生产报表详情
      parameters:
        - name: reportId
          in: path
          required: true
          schema:
            type: integer
          description: 报表ID
          example: 1695476400000
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  reportId:
                    type: integer
                    example: 1695476400000
                  reportType:
                    type: string
                    example: "日报"
                  dateRange:
                    type: object
                    properties:
                      start:
                        type: string
                        example: "2025-09-23T00:00:00Z"
                      end:
                        type: string
                        example: "2025-09-23T23:59:59Z"
                  machines:
                    type: array
                    items:
                      type: string
                    example: ["MACHINE-001", "MACHINE-002"]
                  summary:
                    type: object
                    properties:
                      totalWorkpieces:
                        type: integer
                        example: 120
                      completedWorkpieces:
                        type: integer
                        example: 115
                      defectRate:
                        type: number
                        example: 0.042
                      totalOperatingTime:
                        type: number
                        example: 18.5
                  details:
                    type: array
                    items:
                      type: object
                      properties:
                        machineId:
                          type: string
                          example: "MACHINE-001"
                        totalWorkpieces:
                          type: integer
                          example: 60
                        completedWorkpieces:
                          type: integer
                          example: 58
                        defectRate:
                          type: number
                          example: 0.033
                        totalOperatingTime:
                          type: number
                          example: 9.2
                  generatedBy:
                    type: string
                    example: "系统管理员"
                  generatedAt:
                    type: string
                    example: "2025-09-23T23:45:00Z"
        '400':
          description: 无效的报表ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的报表ID"
  /cnc/process/reports/machine/{machineId}:
    get:
      tags:
        - 生产报表
      summary: 查询设备生产报表
      description: 查询指定设备的生产报表
      parameters:
        - name: machineId
          in: path
          required: true
          schema:
            type: string
          description: 设备ID
          example: "MACHINE-001"
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  reportType:
                    type: string
                    example: "设备日报"
                  dateRange:
                    type: object
                    properties:
                      start:
                        type: string
                        example: "2025-09-23T00:00:00Z"
                      end:
                        type: string
                        example: "2025-09-23T23:59:59Z"
                  summary:
                    type: object
                    properties:
                      totalWorkpieces:
                        type: integer
                        example: 60
                      completedWorkpieces:
                        type: integer
                        example: 58
                      defectRate:
                        type: number
                        example: 0.033
                      totalOperatingTime:
                        type: number
                        example: 9.2
                      efficiency:
                        type: number
                        example: 0.92
                  details:
                    type: array
                    items:
                      type: object
                      properties:
                        shift:
                          type: string
                          example: "早班"
                        totalWorkpieces:
                          type: integer
                          example: 30
                        completedWorkpieces:
                          type: integer
                          example: 29
                        defectRate:
                          type: number
                          example: 0.033
                        operatingTime:
                          type: number
                          example: 4.6
        '400':
          description: 无效的设备ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的设备ID"
