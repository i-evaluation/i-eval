openapi: 3.0.3
info:
  title: CNC设备能耗与效率控制器API
  description: CNC设备能耗监控和效率分析相关接口
  version: 1.0.0
  contact:
    name: CNC设备能耗与效率API
servers:
  - url: http://192.168.2.201:8083
tags:
  - name: 设备能耗
    description: 设备能耗监控相关操作
  - name: 效率分析
    description: 设备效率分析相关操作
  - name: 停机记录
    description: 设备停机记录相关操作
paths:
  /cnc/process/efficiency/power:
    post:
      tags:
        - 设备能耗
      summary: 上传能耗数据
      description: 上传设备能耗监测数据
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                machineId:
                  type: string
                  description: 设备ID
                  example: "MACHINE-001"
                timestamp:
                  type: string
                  description: 时间戳
                  example: "2025-09-23T10:30:00Z"
                powerConsumption:
                  type: number
                  description: 能耗值
                  example: 15.5
                voltage:
                  type: number
                  description: 电压
                  example: 380.0
                current:
                  type: number
                  description: 电流
                  example: 25.3
                powerFactor:
                  type: number
                  description: 功率因数
                  example: 0.92
              required:
                - machineId
                - timestamp
                - powerConsumption
                - voltage
                - current
                - powerFactor
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  recordId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  timestamp:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  powerConsumption:
                    type: number
                    example: 15.5
                  voltage:
                    type: number
                    example: 380.0
                  current:
                    type: number
                    example: 25.3
                  powerFactor:
                    type: number
                    example: 0.92
                  createdAt:
                    type: string
                    format: date-time
    get:
      tags:
        - 设备能耗
      summary: 查询能耗数据
      description: 根据记录ID查询能耗数据
      parameters:
        - name: recordId
          in: path
          required: true
          schema:
            type: integer
          description: 记录ID
          example: 1695476400000
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  recordId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  timestamp:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  powerConsumption:
                    type: number
                    example: 15.5
                  voltage:
                    type: number
                    example: 380.0
                  current:
                    type: number
                    example: 25.3
                  powerFactor:
                    type: number
                    example: 0.92
        '400':
          description: 无效的记录ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的记录ID"
  /cnc/process/efficiency/power/machine/{machineId}/total:
    get:
      tags:
        - 设备能耗
      summary: 查询总能耗
      description: 查询设备总能耗统计
      parameters:
        - name: machineId
          in: path
          required: true
          schema:
            type: string
          description: 设备ID
          example: "MACHINE-001"
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  dateRange:
                    type: object
                    properties:
                      start:
                        type: string
                        example: "2025-09-23T00:00:00Z"
                      end:
                        type: string
                        example: "2025-09-23T23:59:59Z"
                  totalPowerConsumption:
                    type: number
                    example: 124.5
                  averagePowerConsumption:
                    type: number
                    example: 15.6
                  peakPowerConsumption:
                    type: number
                    example: 18.2
                  peakTime:
                    type: string
                    example: "2025-09-23T14:30:00Z"
        '400':
          description: 无效的设备ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的设备ID"
  /cnc/process/efficiency/efficiency:
    post:
      tags:
        - 效率分析
      summary: 上传运行效率
      description: 上传设备运行效率数据
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                machineId:
                  type: string
                  description: 设备ID
                  example: "MACHINE-001"
                timestamp:
                  type: string
                  description: 时间戳
                  example: "2025-09-23T10:30:00Z"
                efficiency:
                  type: number
                  description: 效率值
                  example: 0.92
                utilizationRate:
                  type: number
                  description: 利用率
                  example: 0.85
                oee:
                  type: number
                  description: 设备综合效率
                  example: 0.78
              required:
                - machineId
                - timestamp
                - efficiency
                - utilizationRate
                - oee
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  recordId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  timestamp:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  efficiency:
                    type: number
                    example: 0.92
                  utilizationRate:
                    type: number
                    example: 0.85
                  oee:
                    type: number
                    example: 0.78
                  createdAt:
                    type: string
                    format: date-time
    get:
      tags:
        - 效率分析
      summary: 查询运行效率
      description: 根据记录ID查询运行效率数据
      parameters:
        - name: recordId
          in: path
          required: true
          schema:
            type: integer
          description: 记录ID
          example: 1695476400000
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  recordId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  timestamp:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  efficiency:
                    type: number
                    example: 0.92
                  utilizationRate:
                    type: number
                    example: 0.85
                  oee:
                    type: number
                    example: 0.78
        '400':
          description: 无效的记录ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的记录ID"
  /cnc/process/efficiency/efficiency/machine/{machineId}/average:
    get:
      tags:
        - 效率分析
      summary: 查询平均效率
      description: 查询设备平均效率统计
      parameters:
        - name: machineId
          in: path
          required: true
          schema:
            type: string
          description: 设备ID
          example: "MACHINE-001"
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  dateRange:
                    type: object
                    properties:
                      start:
                        type: string
                        example: "2025-09-23T00:00:00Z"
                      end:
                        type: string
                        example: "2025-09-23T23:59:59Z"
                  averageEfficiency:
                    type: number
                    example: 0.90
                  averageUtilizationRate:
                    type: number
                    example: 0.83
                  averageOEE:
                    type: number
                    example: 0.75
                  peakEfficiency:
                    type: number
                    example: 0.95
                  peakTime:
                    type: string
                    example: "2025-09-23T09:30:00Z"
        '400':
          description: 无效的设备ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的设备ID"
  /cnc/process/efficiency/downtime:
    post:
      tags:
        - 停机记录
      summary: 上传停机记录
      description: 上传设备停机记录
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                machineId:
                  type: string
                  description: 设备ID
                  example: "MACHINE-001"
                startTime:
                  type: string
                  description: 开始时间
                  example: "2025-09-23T10:30:00Z"
                endTime:
                  type: string
                  description: 结束时间
                  example: "2025-09-23T11:00:00Z"
                duration:
                  type: integer
                  description: 停机时长(分钟)
                  example: 30
                reason:
                  type: string
                  description: 停机原因
                  example: "主轴温度过高"
                category:
                  type: string
                  description: 停机类别
                  example: "设备故障"
              required:
                - machineId
                - startTime
                - endTime
                - duration
                - reason
                - category
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  downtimeId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  startTime:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  endTime:
                    type: string
                    example: "2025-09-23T11:00:00Z"
                  duration:
                    type: integer
                    example: 30
                  reason:
                    type: string
                    example: "主轴温度过高"
                  category:
                    type: string
                    example: "设备故障"
                  createdAt:
                    type: string
                    format: date-time
  /cnc/process/efficiency/downtime/{downtimeId}:
    get:
      tags:
        - 停机记录
      summary: 查询停机记录
      description: 根据停机记录ID查询停机记录详情
      parameters:
        - name: downtimeId
          in: path
          required: true
          schema:
            type: integer
          description: 停机记录ID
          example: 1695476400000
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  downtimeId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  startTime:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  endTime:
                    type: string
                    example: "2025-09-23T11:00:00Z"
                  duration:
                    type: integer
                    example: 30
                  reason:
                    type: string
                    example: "主轴温度过高"
                  category:
                    type: string
                    example: "设备故障"
                  status:
                    type: string
                    example: "已解决"
        '400':
          description: 无效的停机记录ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的停机记录ID"
  /cnc/process/efficiency/downtime/machine/{machineId}:
    get:
      tags:
        - 停机记录
      summary: 查询设备所有停机记录
      description: 查询指定设备的所有停机记录
      parameters:
        - name: machineId
          in: path
          required: true
          schema:
            type: string
          description: 设备ID
          example: "MACHINE-001"
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  dateRange:
                    type: object
                    properties:
                      start:
                        type: string
                        example: "2025-09-23T00:00:00Z"
                      end:
                        type: string
                        example: "2025-09-23T23:59:59Z"
                  totalDowntime:
                    type: integer
                    example: 45
                  records:
                    type: array
                    items:
                      type: object
                      properties:
                        downtimeId:
                          type: integer
                          example: 1
                        startTime:
                          type: string
                          example: "2025-09-23T10:30:00Z"
                        endTime:
                          type: string
                          example: "2025-09-23T11:00:00Z"
                        duration:
                          type: integer
                          example: 30
                        reason:
                          type: string
                          example: "主轴温度过高"
                        category:
                          type: string
                          example: "设备故障"
                        status:
                          type: string
                          example: "已解决"
        '400':
          description: 无效的设备ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的设备ID"
  /cnc/process/efficiency/report/machine/{machineId}:
    get:
      tags:
        - 效率分析
      summary: 查询综合效率报表
      description: 查询设备综合效率分析报表
      parameters:
        - name: machineId
          in: path
          required: true
          schema:
            type: string
          description: 设备ID
          example: "MACHINE-001"
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  dateRange:
                    type: object
                    properties:
                      start:
                        type: string
                        example: "2025-09-23T00:00:00Z"
                      end:
                        type: string
                        example: "2025-09-23T23:59:59Z"
                  summary:
                    type: object
                    properties:
                      oee:
                        type: number
                        example: 0.78
                      availability:
                        type: number
                        example: 0.92
                      performance:
                        type: number
                        example: 0.85
                      quality:
                        type: number
                        example: 0.99
                      totalPowerConsumption:
                        type: number
                        example: 124.5
                      totalDowntime:
                        type: integer
                        example: 45
                  details:
                    type: array
                    items:
                      type: object
                      properties:
                        shift:
                          type: string
                          example: "早班"
                        oee:
                          type: number
                          example: 0.80
                        availability:
                          type: number
                          example: 0.95
                        performance:
                          type: number
                          example: 0.87
                        quality:
                          type: number
                          example: 0.97
                        powerConsumption:
                          type: number
                          example: 62.3
                        downtime:
                          type: integer
                          example: 20
        '400':
          description: 无效的设备ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的设备ID"
