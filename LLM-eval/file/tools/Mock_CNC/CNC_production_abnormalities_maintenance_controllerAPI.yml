openapi: 3.0.3
info:
  title: CNC生产异常与维护控制器API
  description: CNC生产异常处理和设备维护管理相关接口
  version: 1.0.0
  contact:
    name: CNC生产异常与维护API
servers:
  - url: http://192.168.2.201:8083
    description: 开发环境服务器
tags:
  - name: 异常处理
    description: 生产异常处理相关操作
  - name: 维修管理
    description: 设备维修管理相关操作
  - name: 维护计划
    description: 设备维护计划相关操作
paths:
  /cnc/process/maintenance/exceptions:
    post:
      tags:
        - 异常处理
      summary: 上传生产异常
      description: 上传生产异常信息
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                machineId:
                  type: string
                  description: 设备ID
                  example: "MACHINE-001"
                exceptionType:
                  type: string
                  description: 异常类型
                  example: "设备故障"
                description:
                  type: string
                  description: 异常描述
                  example: "主轴温度过高"
                severity:
                  type: string
                  description: 严重程度
                  example: "高"
                occurredAt:
                  type: string
                  description: 发生时间
                  example: "2025-09-23T10:30:00Z"
              required:
                - machineId
                - exceptionType
                - description
                - severity
                - occurredAt
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  exceptionId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  exceptionType:
                    type: string
                    example: "设备故障"
                  description:
                    type: string
                    example: "主轴温度过高"
                  severity:
                    type: string
                    example: "高"
                  occurredAt:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  createdAt:
                    type: string
                    format: date-time
  /cnc/process/maintenance/exceptions/{exceptionId}:
    get:
      tags:
        - 异常处理
      summary: 查询异常
      description: 根据异常ID查询异常详情
      parameters:
        - name: exceptionId
          in: path
          required: true
          schema:
            type: integer
          description: 异常ID
          example: 1695476400000
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  exceptionId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  exceptionType:
                    type: string
                    example: "设备故障"
                  description:
                    type: string
                    example: "主轴温度过高"
                  severity:
                    type: string
                    example: "高"
                  occurredAt:
                    type: string
                    example: "2025-09-23T10:30:00Z"
                  status:
                    type: string
                    example: "待处理"
        '400':
          description: 无效的异常ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的异常ID"
  /cnc/process/maintenance/exceptions/machine/{machineId}:
    get:
      tags:
        - 异常处理
      summary: 查询设备异常
      description: 查询指定设备的所有异常记录
      parameters:
        - name: machineId
          in: path
          required: true
          schema:
            type: string
          description: 设备ID
          example: "MACHINE-001"
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  exceptions:
                    type: array
                    items:
                      type: object
                      properties:
                        exceptionId:
                          type: integer
                          example: 1
                        description:
                          type: string
                          example: "主轴温度过高"
                        severity:
                          type: string
                          example: "高"
                        occurredAt:
                          type: string
                          example: "2025-09-23T10:30:00Z"
                        status:
                          type: string
                          example: "待处理"
        '400':
          description: 无效的设备ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的设备ID"
  /cnc/process/maintenance/repairs:
    post:
      tags:
        - 维修管理
      summary: 上传维修记录
      description: 上传设备维修记录
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                machineId:
                  type: string
                  description: 设备ID
                  example: "MACHINE-001"
                exceptionId:
                  type: string
                  description: 异常ID
                  example: "EXCEPTION-001"
                repairType:
                  type: string
                  description: 维修类型
                  example: "更换零件"
                description:
                  type: string
                  description: 维修描述
                  example: "更换主轴轴承"
                technician:
                  type: string
                  description: 维修技师
                  example: "张工"
                duration:
                  type: integer
                  description: 维修时长(分钟)
                  example: 120
                repairedAt:
                  type: string
                  description: 维修完成时间
                  example: "2025-09-23T12:00:00Z"
              required:
                - machineId
                - exceptionId
                - repairType
                - description
                - technician
                - duration
                - repairedAt
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  repairId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  exceptionId:
                    type: string
                    example: "EXCEPTION-001"
                  repairType:
                    type: string
                    example: "更换零件"
                  description:
                    type: string
                    example: "更换主轴轴承"
                  technician:
                    type: string
                    example: "张工"
                  duration:
                    type: integer
                    example: 120
                  repairedAt:
                    type: string
                    example: "2025-09-23T12:00:00Z"
                  createdAt:
                    type: string
                    format: date-time
  /cnc/process/maintenance/repairs/{repairId}:
    get:
      tags:
        - 维修管理
      summary: 查询维修记录
      description: 根据维修ID查询维修记录详情
      parameters:
        - name: repairId
          in: path
          required: true
          schema:
            type: integer
          description: 维修ID
          example: 1695476400000
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  repairId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  exceptionId:
                    type: string
                    example: "EXCEPTION-001"
                  repairType:
                    type: string
                    example: "更换零件"
                  description:
                    type: string
                    example: "更换主轴轴承"
                  technician:
                    type: string
                    example: "张工"
                  duration:
                    type: integer
                    example: 120
                  repairedAt:
                    type: string
                    example: "2025-09-23T12:00:00Z"
                  status:
                    type: string
                    example: "已完成"
        '400':
          description: 无效的维修ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的维修ID"
  /cnc/process/maintenance/repairs/machine/{machineId}:
    get:
      tags:
        - 维修管理
      summary: 查询设备维修记录
      description: 查询指定设备的所有维修记录
      parameters:
        - name: machineId
          in: path
          required: true
          schema:
            type: string
          description: 设备ID
          example: "MACHINE-001"
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  repairs:
                    type: array
                    items:
                      type: object
                      properties:
                        repairId:
                          type: integer
                          example: 1
                        description:
                          type: string
                          example: "更换主轴轴承"
                        technician:
                          type: string
                          example: "张工"
                        duration:
                          type: integer
                          example: 120
                        repairedAt:
                          type: string
                          example: "2025-09-23T12:00:00Z"
                        status:
                          type: string
                          example: "已完成"
        '400':
          description: 无效的设备ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的设备ID"
  /cnc/process/maintenance/exceptions/{exceptionId}/resolution:
    post:
      tags:
        - 异常处理
      summary: 上传异常处理结果
      description: 上传异常处理结果信息
      parameters:
        - name: exceptionId
          in: path
          required: true
          schema:
            type: integer
          description: 异常ID
          example: 1695476400000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                resolution:
                  type: string
                  description: 处理方案
                  example: "更换主轴轴承并添加润滑剂"
                resolvedBy:
                  type: string
                  description: 处理人
                  example: "张工"
                resolvedAt:
                  type: string
                  description: 处理时间
                  example: "2025-09-23T12:30:00Z"
              required:
                - resolution
                - resolvedBy
                - resolvedAt
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  exceptionId:
                    type: integer
                    example: 1695476400000
                  resolution:
                    type: string
                    example: "更换主轴轴承并添加润滑剂"
                  resolvedBy:
                    type: string
                    example: "张工"
                  resolvedAt:
                    type: string
                    example: "2025-09-23T12:30:00Z"
                  status:
                    type: string
                    example: "已解决"
                  updatedAt:
                    type: string
                    format: date-time
        '400':
          description: 无效的异常ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的异常ID"
    get:
      tags:
        - 异常处理
      summary: 查询异常处理结果
      description: 查询异常处理结果详情
      parameters:
        - name: exceptionId
          in: path
          required: true
          schema:
            type: integer
          description: 异常ID
          example: 1695476400000
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  exceptionId:
                    type: integer
                    example: 1695476400000
                  resolution:
                    type: string
                    example: "更换主轴轴承并添加润滑剂"
                  resolvedBy:
                    type: string
                    example: "张工"
                  resolvedAt:
                    type: string
                    example: "2025-09-23T12:30:00Z"
                  status:
                    type: string
                    example: "已解决"
        '400':
          description: 无效的异常ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的异常ID"
  /cnc/process/maintenance/plans:
    post:
      tags:
        - 维护计划
      summary: 上传维修计划
      description: 上传设备维修计划
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                machineId:
                  type: string
                  description: 设备ID
                  example: "MACHINE-001"
                planType:
                  type: string
                  description: 计划类型
                  example: "定期保养"
                description:
                  type: string
                  description: 计划描述
                  example: "主轴轴承润滑和检查"
                scheduledDate:
                  type: string
                  description: 计划日期
                  example: "2025-10-01T09:00:00Z"
                technician:
                  type: string
                  description: 维修技师
                  example: "张工"
                estimatedDuration:
                  type: integer
                  description: 预计时长(分钟)
                  example: 180
              required:
                - machineId
                - planType
                - description
                - scheduledDate
                - technician
                - estimatedDuration
      responses:
        '200':
          description: 上传成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  planId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  planType:
                    type: string
                    example: "定期保养"
                  description:
                    type: string
                    example: "主轴轴承润滑和检查"
                  scheduledDate:
                    type: string
                    example: "2025-10-01T09:00:00Z"
                  technician:
                    type: string
                    example: "张工"
                  estimatedDuration:
                    type: integer
                    example: 180
                  createdAt:
                    type: string
                    format: date-time
  /cnc/process/maintenance/plans/{planId}:
    get:
      tags:
        - 维护计划
      summary: 查询维修计划
      description: 根据计划ID查询维修计划详情
      parameters:
        - name: planId
          in: path
          required: true
          schema:
            type: integer
          description: 计划ID
          example: 1695476400000
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  planId:
                    type: integer
                    example: 1695476400000
                  machineId:
                    type: string
                    example: "MACHINE-001"
                  planType:
                    type: string
                    example: "定期保养"
                  description:
                    type: string
                    example: "主轴轴承润滑和检查"
                  scheduledDate:
                    type: string
                    example: "2025-10-01T09:00:00Z"
                  technician:
                    type: string
                    example: "张工"
                  estimatedDuration:
                    type: integer
                    example: 180
                  status:
                    type: string
                    example: "计划中"
        '400':
          description: 无效的计划ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "无效的计划ID"
